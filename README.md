# F1‚ÄëTSP‚ÄëOptimization

Optimize the Formula 1 season calendar with the **Traveling Salesman Problem (TSP)** to minimize total travel distance (logistics cost & CO‚ÇÇ). The repo includes a **Python heuristic pipeline** and **AMPL exact models**, plus optional **map visualization**.

## üöÄ Quick Start

1) **Open the folder**, then create/activate a venv:
```powershell
py -m venv .venv
# If PowerShell blocks activation, run the next line first:
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
.\.venv\Scripts\Activate.ps1
```

2) **Install minimal dependencies** (enough to run algorithms & AMPL export):
```powershell
python -m pip install -U pip
python -m pip install -r requirements-min.txt
```

3) **Smoke test (nearest neighbor)**:
```powershell
python -m src.test_runner
```
It reads `data/f1_tracks.xlsx`, computes a nearest‚Äëneighbor tour, and prints the route & total miles.

> `src/` is a package (contains `__init__.py`). Always prefer `python -m src.xxx` to avoid relative‚Äëimport issues.

---

## üì¶ Repository Structure

```
F1-TSP-Optimization/
‚îú‚îÄ README.md
‚îú‚îÄ requirements.txt           # full deps (incl. cartopy for maps)
‚îú‚îÄ requirements-min.txt       # minimal deps (numpy/pandas/openpyxl)
‚îú‚îÄ data/
‚îÇ  ‚îú‚îÄ f1_tracks.xlsx          # city + lat/lon (feel free to replace)
‚îÇ  ‚îî‚îÄ schedule_order.csv      # exported by AMPL rounds model
‚îú‚îÄ ampl/
‚îÇ  ‚îú‚îÄ tsp_basic.mod           # MTZ TSP
‚îÇ  ‚îú‚îÄ tsp_rounds.mod          # Position-assignment with business rules
‚îÇ  ‚îî‚îÄ f1_tsp.dat              # generated by Python (export_for_ampl.py)
‚îî‚îÄ src/
   ‚îú‚îÄ __init__.py             # marks package
   ‚îú‚îÄ haversine.py
   ‚îú‚îÄ calculate_matrix.py
   ‚îú‚îÄ tsp_bruteforce.py
   ‚îú‚îÄ tsp_heuristic.py
   ‚îú‚îÄ tsp_visualization.py    # requires cartopy
   ‚îú‚îÄ test_runner.py          # quick smoke test
   ‚îú‚îÄ export_for_ampl.py      # Excel -> AMPL .dat
   ‚îú‚îÄ plot_from_arcs.py       # visualize AMPL basic solution
   ‚îî‚îÄ plot_from_schedule.py   # visualize AMPL rounds solution
```

---

## üßÆ AMPL (Exact Models)

### 1) Generate `.dat` from Excel
```powershell
python -m src.export_for_ampl  # writes ampl/f1_tsp.dat
```

### 2) Basic TSP (MTZ)
In AMPL:
```
model ampl/tsp_basic.mod;
data  ampl/f1_tsp.dat;
option solver cplex;    # or gurobi/other
solve;
display TotalDistance;

# Export chosen arcs for visualization
printf "%s,%s\n", i, j > "ampl/solution_arcs.csv";
for {i in CITIES, j in CITIES: i <> j && x[i,j] > 0.5} {
  printf "%s,%s\n", i, j >> "ampl/solution_arcs.csv";
}
```

### 3) Rounds Model (business rules)
```
model ampl/tsp_rounds.mod;
data  ampl/f1_tsp.dat;
option solver cplex;
solve;
display TotalDistance;

# Export schedule as (CitySymbol,Round)
printf "CitySymbol,Round\n" > "data/schedule_order.csv";
for {c in CITIES, r in 1..card(CITIES): y[c,r] > 0.5} {
  printf "%s,%d\n", c, r >> "data/schedule_order.csv";
}
```

---

## üó∫Ô∏è Visualization

### A) Without cartopy (quick check)
- For **basic model**, `ampl/solution_arcs.csv` already lists arcs; the route order can be rebuilt by `src/plot_from_arcs.py` (it can also draw if cartopy is installed).
- For **rounds model**, `data/schedule_order.csv` is already ordered by round; open/sort to inspect.

### B) World map (requires cartopy)
Installing `cartopy` on Windows is easiest via **conda**:
```powershell
conda create -n f1-tsp python=3.11 numpy pandas matplotlib cartopy -c conda-forge
conda activate f1-tsp
```
Then in VS Code select this interpreter and run:
```powershell
# Basic model
python -m src.plot_from_arcs
# Rounds model
python -m src.plot_from_schedule
```


---

## üìë Notes (Results)
The project report (`report.pdf`) summarizes methods & findings (e.g., total mileage reduction vs. original calendar and vs. nearest‚Äëneighbor heuristic).
